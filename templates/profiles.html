{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="display-6"><i class="bi bi-people-fill"></i> Manage Profiles</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="{{ url_for('add_profile') }}" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Add New Profile
        </a>
    </div>
</div>

<p class="lead">Here you can manage profiles for yourself and your family members. Select a profile to view its dashboard and health records.</p>

<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    {% for profile in profiles %}
    <div class="col">
        <div class="card h-100 shadow-sm text-center">
            <div class="card-body">
                <img src="{% if profile.profile_picture %}{{ url_for('uploaded_file', profile_id=profile.id, filename=profile.profile_picture) }}{% else %}{{ url_for('static', filename='uploads/default.png') }}{% endif %}"
                    class="img-fluid rounded-circle mb-3" 
                    style="width: 100px; height: 100px; object-fit: cover;" alt="Profile Picture"
                    onerror="this.onerror=null;this.src='https://via.placeholder.com/100';">
                <h5 class="card-title">{{ profile.profile_name }}</h5>
                {% if profile.is_manager %}
                    <span class="badge bg-success">Account Manager</span>
                {% else %}
                    <span class="badge bg-secondary">Dependent</span>
                {% endif %}
            </div>
            <div class="card-footer bg-white d-flex justify-content-center gap-2">
                <a href="{{ url_for('switch_profile', profile_id=profile.id) }}" class="btn btn-primary btn-sm">Switch to Profile</a>
                <a href="{{ url_for('manage_profile', profile_id=profile.id) }}" class="btn btn-outline-secondary btn-sm">Edit</a>
                
                {% if not profile.is_manager %}
                <form action="{{ url_for('delete_profile', profile_id=profile.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this profile? All associated data will be lost.');">
                    <button type="submit" class="btn btn-outline-danger btn-sm">Delete</button>
                </form>
                {% endif %}
            </div>
        </div>
    </div>
    {% else %}
    <div class="col-12">
        <p>No profiles found. Add your first dependent profile to get started.</p>
    </div>
    {% endfor %}
</div>
{% endblock %}